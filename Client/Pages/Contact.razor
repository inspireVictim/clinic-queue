@page "/contact"
@using System.ComponentModel.DataAnnotations
@inject ISnackbar Snackbar

<PageTitle>Контакты - Стоматологическая очередь</PageTitle>

<MudContainer MaxWidth="MaxWidth.Large">
    <MudText Typo="Typo.h4" Class="mb-6">Свяжитесь с нами</MudText>
    
    <MudGrid>
        <MudItem xs="12" md="6">
            <MudPaper Class="pa-6" Elevation="1">
                <MudText Typo="Typo.h5" Class="mb-4">Контактная информация</MudText>
                
                <MudStack Spacing="3">
                    <MudStack Row="true" AlignItems="AlignItems.Center" Spacing="3">
                        <MudIcon Icon="Icons.Material.Filled.Phone" Color="Color.Primary" />
                        <MudStack Row="false" Spacing="0">
                            <MudText Typo="Typo.body1"><strong>Телефон поддержки</strong></MudText>
                            <MudText Typo="Typo.body2">+7 (495) 123-45-67</MudText>
                            <MudText Typo="Typo.caption">Пн-Пт: 9:00-18:00, Сб: 10:00-16:00</MudText>
                        </MudStack>
                    </MudStack>
                    
                    <MudStack Row="true" AlignItems="AlignItems.Center" Spacing="3">
                        <MudIcon Icon="Icons.Material.Filled.Email" Color="Color.Primary" />
                        <MudStack Row="false" Spacing="0">
                            <MudText Typo="Typo.body1"><strong>Email</strong></MudText>
                            <MudText Typo="Typo.body2">support@dentistqueue.ru</MudText>
                            <MudText Typo="Typo.caption">Ответим в течение 24 часов</MudText>
                        </MudStack>
                    </MudStack>
                    
                    <MudStack Row="true" AlignItems="AlignItems.Center" Spacing="3">
                        <MudIcon Icon="Icons.Material.Filled.LocationOn" Color="Color.Primary" />
                        <MudStack Row="false" Spacing="0">
                            <MudText Typo="Typo.body1"><strong>Адрес офиса</strong></MudText>
                            <MudText Typo="Typo.body2">г. Москва, ул. Тверская, д. 1, офис 101</MudText>
                            <MudText Typo="Typo.caption">Метро: Охотный ряд, Театральная</MudText>
                        </MudStack>
                    </MudStack>
                    
                    <MudStack Row="true" AlignItems="AlignItems.Center" Spacing="3">
                        <MudIcon Icon="Icons.Material.Filled.Schedule" Color="Color.Primary" />
                        <MudStack Row="false" Spacing="0">
                            <MudText Typo="Typo.body1"><strong>Часы работы</strong></MudText>
                            <MudText Typo="Typo.body2">Понедельник - Пятница: 9:00 - 18:00</MudText>
                            <MudText Typo="Typo.body2">Суббота: 10:00 - 16:00</MudText>
                            <MudText Typo="Typo.body2">Воскресенье: выходной</MudText>
                        </MudStack>
                    </MudStack>
                </MudStack>
                
                <MudDivider Class="my-4" />
                
                <MudText Typo="Typo.h6" Class="mb-3">Социальные сети</MudText>
                <MudStack Row="true" Spacing="2">
                    <MudIconButton Icon="Icons.Custom.Brands.Telegram" 
                                  Color="Color.Primary" 
                                  Href="https://t.me/dentistqueue" 
                                  Target="_blank" />
                    <MudIconButton Icon="Icons.Custom.Brands.WhatsApp" 
                                  Color="Color.Success" 
                                  Href="https://wa.me/74951234567" 
                                  Target="_blank" />
                    <MudIconButton Icon="Icons.Custom.Brands.YouTube" 
                                  Color="Color.Error" 
                                  Href="https://youtube.com/dentistqueue" 
                                  Target="_blank" />
                </MudStack>
            </MudPaper>
        </MudItem>
        
        <MudItem xs="12" md="6">
            <MudPaper Class="pa-6" Elevation="1">
                <MudText Typo="Typo.h5" Class="mb-4">Форма обратной связи</MudText>
                
                <MudForm @ref="contactForm">
                    <MudStack Spacing="4">
                        <MudTextField @bind-Value="contactData.Name"
                                     Label="Ваше имя"
                                     Variant="Variant.Outlined"
                                     Required="true"
                                     RequiredError="Введите ваше имя" />
                        
                        <MudTextField @bind-Value="contactData.Email"
                                     Label="Email"
                                     Variant="Variant.Outlined"
                                     Required="true"
                                     RequiredError="Введите email"
                                     Validation="@(new EmailAddressAttribute() { ErrorMessage = "Некорректный email" })" />
                        
                        <MudTextField @bind-Value="contactData.Phone"
                                     Label="Телефон (необязательно)"
                                     Variant="Variant.Outlined" />
                        
                        <MudSelect @bind-Value="contactData.Subject" 
                                  Label="Тема обращения" 
                                  Variant="Variant.Outlined"
                                  Required="true">
                            <MudSelectItem Value="@("support")">Техническая поддержка</MudSelectItem>
                            <MudSelectItem Value="@("partnership")">Партнерство</MudSelectItem>
                            <MudSelectItem Value="@("complaint")">Жалоба</MudSelectItem>
                            <MudSelectItem Value="@("suggestion")">Предложение</MudSelectItem>
                            <MudSelectItem Value="@("other")">Другое</MudSelectItem>
                        </MudSelect>
                        
                        <MudTextField @bind-Value="contactData.Message"
                                     Label="Сообщение"
                                     Variant="Variant.Outlined"
                                     Lines="5"
                                     Required="true"
                                     RequiredError="Введите сообщение" />
                        
                        <MudCheckBox @bind-Value="contactData.AgreeToPrivacy" 
                                    Label="Я согласен на обработку персональных данных" 
                                    Color="Color.Primary" 
                                    Required="true" />
                        
                        <MudButton Variant="Variant.Filled"
                                  Color="Color.Primary"
                                  Size="Size.Large"
                                  OnClick="SendMessage"
                                  Disabled="@(isSending || !contactData.AgreeToPrivacy)"
                                  FullWidth="true">
                            @if (isSending)
                            {
                                <MudProgressCircular Size="Size.Small" Indeterminate="true" Class="mr-2" />
                                <MudText>Отправка...</MudText>
                            }
                            else
                            {
                                <MudText>Отправить сообщение</MudText>
                            }
                        </MudButton>
                    </MudStack>
                </MudForm>
            </MudPaper>
        </MudItem>
    </MudGrid>
    
    <MudPaper Class="pa-6 mt-6" Elevation="1">
        <MudText Typo="Typo.h5" Class="mb-4">Часто задаваемые вопросы</MudText>
        
        <MudExpansionPanels>
            <MudExpansionPanel Text="Как записаться на прием?">
                <MudText>
                    Для записи на прием найдите подходящего врача через поиск, выберите удобное время и подтвердите запись. 
                    Для этого необходимо быть зарегистрированным пользователем.
                </MudText>
            </MudExpansionPanel>
            
            <MudExpansionPanel Text="Можно ли отменить запись?">
                <MudText>
                    Да, вы можете отменить запись не позднее чем за 24 часа до назначенного времени. 
                    Отмена производится в разделе "Мои записи".
                </MudText>
            </MudExpansionPanel>
            
            <MudExpansionPanel Text="Как стать партнером?">
                <MudText>
                    Если вы врач-стоматолог или представляете клинику, зарегистрируйтесь как врач и заполните профиль. 
                    Наша команда свяжется с вами для подтверждения данных.
                </MudText>
            </MudExpansionPanel>
            
            <MudExpansionPanel Text="Безопасно ли это?">
                <MudText>
                    Мы используем современные технологии защиты данных. Все данные передаются по защищенному соединению, 
                    а платежи обрабатываются через проверенные платежные системы.
                </MudText>
            </MudExpansionPanel>
        </MudExpansionPanels>
    </MudPaper>
</MudContainer>

@code {
    private MudForm contactForm = null!;
    private bool isSending = false;
    private ContactFormData contactData = new();

    private async Task SendMessage()
    {
        await contactForm.Validate();
        
        if (!contactForm.IsValid) return;
        
        try
        {
            isSending = true;
            
            // Имитируем отправку сообщения
            await Task.Delay(2000);
            
            // В реальном приложении здесь будет вызов API для отправки email
            
            // Сброс формы
            contactData = new ContactFormData();
            
            // Уведомление об успехе
            Snackbar.Add("Сообщение отправлено! Мы свяжемся с вами в ближайшее время.", Severity.Success);
        }
        catch (Exception ex)
        {
            Snackbar.Add($"Ошибка отправки сообщения: {ex.Message}", Severity.Error);
        }
        finally
        {
            isSending = false;
        }
    }
    
    private class ContactFormData
    {
        public string Name { get; set; } = string.Empty;
        public string Email { get; set; } = string.Empty;
        public string Phone { get; set; } = string.Empty;
        public string Subject { get; set; } = string.Empty;
        public string Message { get; set; } = string.Empty;
        public bool AgreeToPrivacy { get; set; } = false;
    }
}
